<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Audito - Music Player</title>
<style>
body { background: #111; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; font-family: Arial, sans-serif; }
.app-frame { width: 420px; max-height: 95vh; background: #222; border-radius: 20px; box-shadow: 8px 8px 16px #111, -8px -8px 16px #333; padding: 15px; display: flex; flex-direction: column; align-items: center; overflow: hidden; }
.controls, .eq, .playlist, .debug-log, .volume-control { width: 100%; margin-top: 10px; }
.controls button, .eq button { background: #2a2a2a; border: none; padding: 10px; margin: 5px; border-radius: 12px; color: #fff; cursor: pointer; box-shadow: inset 3px 3px 6px #111, inset -3px -3px 6px #333; }
.eq { display: flex; justify-content: space-around; align-items: flex-end; height: 150px; }
.eq input[type=range] { writing-mode: bt-lr; -webkit-appearance: slider-vertical; width: 20px; height: 120px; }
.volume-control { display: flex; align-items: center; justify-content: center; }
.volume-control input[type=range] { width: 80%; }
canvas { width: 100%; height: 100px; background: black; border-radius: 10px; margin-top: 10px; }
.playlist { flex: 1; overflow-y: auto; background: #111; border-radius: 10px; padding: 10px; color: white; }
.playlist div { padding: 5px; cursor: pointer; }
.playlist div:hover { background: #333; }
.debug-log { background: #000; color: #fff; font-size: 12px; height: 80px; overflow-y: auto; border-radius: 8px; padding: 5px; }
</style>
</head>
<body>
<div class="app-frame">
  <h2 style="color:white;">üéµ Audito</h2>
  <input type="file" id="fileInput" multiple accept="audio/*,video/*">
  <div id="mediaContainer" style="width:100%;"></div>
  <canvas id="spectrum"></canvas>

  <div class="controls">
    <button id="prev">‚èÆ</button>
    <button id="play">‚ñ∂Ô∏è</button>
    <button id="pause">‚è∏</button>
    <button id="stop">‚èπ</button>
    <button id="next">‚è≠</button>
    <button id="loop">Loop: Off</button>
  </div>

  <div class="volume-control">
    <label style="color:white; margin-right:10px;">Volume</label>
    <input type="range" id="volumeSlider" min="0" max="1" step="0.01" value="0.3">
  </div>

  <div class="eq">
    <input type="range" min="-12" max="12" value="0" step="1" data-band="60">
    <input type="range" min="-12" max="12" value="0" step="1" data-band="170">
    <input type="range" min="-12" max="12" value="0" step="1" data-band="350">
    <input type="range" min="-12" max="12" value="0" step="1" data-band="1000">
    <input type="range" min="-12" max="12" value="0" step="1" data-band="3500">
  </div>

  <div class="playlist" id="playlist"></div>
  <div class="debug-log" id="debugLog"></div>
  <p style="color:white; font-size:12px;">¬© Audito 2025</p>
</div>

<script>
let audioContext;
let sourceNode;
let gainNode;
let analyser;
let filters = [];
let currentFileIndex = 0;
let files = [];
let loopMode = 0;

const mediaContainer = document.getElementById('mediaContainer');
const fileInput = document.getElementById('fileInput');
const playlist = document.getElementById('playlist');
const debugLog = document.getElementById('debugLog');
const loopBtn = document.getElementById('loop');
const volumeSlider = document.getElementById('volumeSlider');
let currentMedia;
let audioContextStarted = false;

function log(msg){ debugLog.innerHTML += msg+"<br>"; debugLog.scrollTop = debugLog.scrollHeight; }

function initAudioContext(){
  if(!audioContext){
    audioContext = new (window.AudioContext || window.webkitAudioContext)();
    analyser = audioContext.createAnalyser();
    gainNode = audioContext.createGain();
    gainNode.gain.value = volumeSlider.value;
    analyser.fftSize = 256;
    setupEQ();
  }
}

volumeSlider.oninput = ()=>{
  if(currentMedia) currentMedia.volume = volumeSlider.value;
  if(gainNode) gainNode.gain.value = volumeSlider.value;
  log(`Volume set to ${Math.round(volumeSlider.value*100)}%`);
};

function setupEQ(){
  const bands = [60,170,350,1000,3500];
  filters = bands.map(f => { let filter = audioContext.createBiquadFilter(); filter.type='peaking'; filter.frequency.value=f; filter.Q.value=1; filter.gain.value=0; return filter; });
  for(let i=0;i<filters.length-1;i++){ filters[i].connect(filters[i+1]); }
  filters[filters.length-1].connect(gainNode);
  gainNode.connect(analyser);
  analyser.connect(audioContext.destination);
  document.querySelectorAll('.eq input').forEach((slider,i)=>{ slider.oninput = e => { filters[i].gain.value=e.target.value; log(`EQ band ${filters[i].frequency.value}Hz set to ${e.target.value}dB`); } });
}

function createMediaElement(file){
  if(currentMedia){ currentMedia.pause(); currentMedia.remove(); if(sourceNode) sourceNode.disconnect(); }
  let url = URL.createObjectURL(file);

  if(file.type.startsWith('video')){
    currentMedia = document.createElement('video');
    currentMedia.src = url;
    currentMedia.controls = true;
    currentMedia.style.width = '100%';
    currentMedia.volume = volumeSlider.value;
    mediaContainer.appendChild(currentMedia);
    // Do NOT connect video to Web Audio API
    currentMedia.play().catch(()=>{});
  } else {
    currentMedia = document.createElement('audio');
    currentMedia.src = url;
    currentMedia.controls = true;
    currentMedia.style.width = '100%';
    currentMedia.volume = volumeSlider.value;
    mediaContainer.appendChild(currentMedia);

    if(!audioContextStarted){
      audioContextStarted = true;
      initAudioContext();
    }
    sourceNode = audioContext.createMediaElementSource(currentMedia);
    sourceNode.connect(filters[0]);
    currentMedia.play().catch(()=>{});
  }

  currentMedia.onended = handleMediaEnd;
  log(`Loaded ${file.type.startsWith('video') ? 'video' : 'audio'}: ${file.name}`);
}

function loadFile(index){ if(index<0 || index>=files.length) return; currentFileIndex = index; createMediaElement(files[index]); }

fileInput.onchange = e => { files = Array.from(e.target.files); playlist.innerHTML = ''; files.forEach((f,i)=>{ let div=document.createElement('div'); div.innerText=f.name; div.onclick=()=>loadFile(i); playlist.appendChild(div); }); if(files.length>0) loadFile(0); };

function play(){ if(currentMedia){ currentMedia.play().catch(()=>{}); log('Playback started'); } }
function pause(){ if(currentMedia) currentMedia.pause(); log('Paused'); }
function stop(){ if(currentMedia){ currentMedia.pause(); currentMedia.currentTime=0; } log('Stopped'); }
function next(){ loadFile((currentFileIndex+1)%files.length); play(); log('Next track'); }
function prev(){ loadFile((currentFileIndex-1+files.length)%files.length); play(); log('Previous track'); }
loopBtn.onclick = ()=>{ loopMode=(loopMode+1)%3; loopBtn.innerText=loopMode===0?'Loop: Off':loopMode===1?'Loop: One':'Loop: All'; log(`Loop mode set to ${loopBtn.innerText}`); };
function handleMediaEnd(){ if(loopMode===1){ play(); } else if(loopMode===2){ next(); } else { stop(); } }

document.getElementById('play').onclick=play;
document.getElementById('pause').onclick=pause;
document.getElementById('stop').onclick=stop;
document.getElementById('prev').onclick=prev;
document.getElementById('next').onclick=next;

const canvas=document.getElementById('spectrum');
const ctx=canvas.getContext('2d');
function drawSpectrum(){ requestAnimationFrame(drawSpectrum); if(!analyser) return; let data=new Uint8Array(analyser.frequencyBinCount); analyser.getByteFrequencyData(data); ctx.clearRect(0,0,canvas.width,canvas.height); let barWidth=(canvas.width/data.length); for(let i=0;i<data.length;i++){ let value=data[i]; ctx.fillStyle='lime'; ctx.fillRect(i*barWidth,canvas.height-value/2,barWidth,value/2); } }
drawSpectrum();
</script>
</body>
</html>
